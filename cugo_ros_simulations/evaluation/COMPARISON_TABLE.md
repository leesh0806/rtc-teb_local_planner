# TEB vs MPPI 파라미터 비교 표

## 📊 전체 파라미터 비교

### 1. 속도 및 가속도 제약 (물리적 제약 - 100% 동일)

| 항목 | 수식 표현 | TEB 파라미터 | TEB 값 | MPPI 파라미터 | MPPI 값 | 동등성 |
|-----|---------|------------|--------|--------------|---------|-------|
| **최대 선속도** | $v_{max}$ | `max_vel_x` | 0.4 m/s | `vx_max` | 0.4 m/s | ✅ |
| **최소 선속도** | $v_{min}$ | (0.0, 묵시) | 0.0 m/s | `vx_min` | -0.2 m/s | ⚠️ 후진 허용 차이 |
| **최대 각속도** | $\omega_{max}$ | `max_vel_theta` | 1.0 rad/s | `wz_max` | 1.0 rad/s | ✅ |
| **최대 선가속도** | $a_{max}$ | `acc_lim_x` | 0.8 m/s² | `ax_max` | 0.8 m/s² | ✅ |
| **최소 선가속도** | $a_{min}$ | (-0.8, 묵시) | -0.8 m/s² | `ax_min` | -0.8 m/s² | ✅ |
| **최대 각가속도** | $\alpha_{max}$ | `acc_lim_theta` | 3.2 rad/s² | `az_max` | 3.2 rad/s² | ✅ |

**수식 정리:**
```
속도 제약: |v(t)| ≤ 0.4 m/s, |ω(t)| ≤ 1.0 rad/s
가속도 제약: |a(t)| ≤ 0.8 m/s², |α(t)| ≤ 3.2 rad/s²
```

---

### 2. 시간 지평 및 예측 (동등하게 설정)

| 항목 | 수식 표현 | TEB 설정 | MPPI 설정 | 계산 결과 | 동등성 |
|-----|---------|---------|----------|----------|-------|
| **예측 시간** | $T_{pred}$ | ~4.0초 (동적) | `80 × 0.05 = 4.0초` | 4.0초 | ✅ |
| **시간 스텝** | $N$ | 동적 (teb_autosize) | `time_steps: 80` | 80 | - |
| **시간 간격** | $\Delta t$ | `dt_ref: 0.3` | `model_dt: 0.05` | - | ⚠️ 알고리즘 특성 |
| **예측 거리** | $d_{pred}$ | $v_{max} \times T$ | $0.4 \times 4.0$ | 1.6 m | ✅ |

**수식:**
```
MPPI 예측 시간:
T_pred = N × Δt = 80 × 0.05 = 4.0 초

예측 거리:
d_pred = v_max × T_pred = 0.4 × 4.0 = 1.6 m
```

**근거:**
- 1.6m는 로컬 플래너의 적절한 예측 거리
- TEB의 평균 예측 거리와 유사
- 20Hz 제어 주파수에서 80 cycles = 4초

---

### 3. 장애물 회피 및 안전 거리 (동등하게 설정)

| 항목 | 수식 표현 | TEB 설정 | TEB 값 | MPPI 설정 | MPPI 값 | 동등성 |
|-----|---------|---------|--------|----------|---------|-------|
| **인플레이션 거리** | $d_{infl}$ | `inflation_dist` | 0.6 m | `inflation_radius` | 0.6 m | ✅ |
| **최소 장애물 거리** | $d_{min}$ | `min_obstacle_dist` | 0.27 m | (costmap 기반) | - | ⚠️ 구현 방식 차이 |
| **충돌 비용** | $C_{coll}$ | `weight_obstacle: 100` | - | `collision_cost: 1000000` | - | ⚠️ 스케일 다름 |

**TEB 비용 함수:**
```
C_obs(d) = {
  ∞                    if d < d_min = 0.27
  k / (d - d_min)      if 0.27 ≤ d < 0.6
  0                    if d ≥ 0.6
}
```

**MPPI 비용 함수:**
```
C_obs(d) = {
  10^6                 if collision (d ≈ 0)
  300 × exp(-d/0.6)    if d < d_infl = 0.6
  0                    if d ≥ 0.6
}
```

**동등성 보장:**
- 인플레이션 거리 0.6m로 통일
- 두 플래너 모두 0.6m 이내에서 회피 동작

---

### 4. 로봇 기하 및 풋프린트 (100% 동일)

| 항목 | 값 | TEB 설정 | MPPI 설정 | 동등성 |
|-----|---|---------|----------|-------|
| **길이** | 0.7 m | `footprint_model.vertices` | `footprint` (costmap) | ✅ |
| **폭** | 0.5 m | 동일 | 동일 | ✅ |
| **풋프린트** | 사각형 | `[[0.35, 0.25], ...]` | `[[0.35, 0.25], ...]` | ✅ |

**좌표:**
```
P1 = ( 0.35,  0.25) [m]  (우측 전방)
P2 = ( 0.35, -0.25) [m]  (우측 후방)
P3 = (-0.35, -0.25) [m]  (좌측 후방)
P4 = (-0.35,  0.25) [m]  (좌측 전방)
```

---

### 5. 목표 정확도 (100% 동일)

| 항목 | 수식 | 값 | TEB/MPPI 공통 설정 | 동등성 |
|-----|-----|---|------------------|-------|
| **위치 허용오차** | $\epsilon_{xy}$ | 0.25 m | `xy_goal_tolerance: 0.25` | ✅ |
| **방향 허용오차** | $\epsilon_\theta$ | 0.25 rad (14.3°) | `yaw_goal_tolerance: 0.25` | ✅ |

**목표 도달 조건:**
```
Goal Reached ⟺ {
  ||p_robot - p_goal||_2 < ε_xy = 0.25 m
  AND
  |θ_robot - θ_goal| < ε_θ = 0.25 rad
}
```

---

### 6. 제어 주파수 (100% 동일)

| 항목 | 수식 | 값 | TEB/MPPI 공통 | 동등성 |
|-----|-----|---|-------------|-------|
| **제어 주파수** | $f_c$ | 20 Hz | `controller_frequency: 20.0` | ✅ |
| **제어 주기** | $T_c = 1/f_c$ | 50 ms | 0.05 s | ✅ |

**의미:**
```
제어 주기 T_c = 50ms
→ 매 50ms마다 새로운 속도 명령 발행
→ 1초에 20개의 제어 명령
```

---

### 7. 계산 복잡도 (알고리즘 특성 - 다를 수 있음)

| 항목 | TEB | MPPI | 비고 |
|-----|-----|------|-----|
| **최적화 방법** | Non-linear Optimization | Sampling-based MPC | 알고리즘 차이 |
| **반복 횟수** | `5 × 4 = 20 iterations` | `1 iteration` | - |
| **샘플/궤적 수** | 1 (최적 궤적) | `2000 trajectories` | GPU 병렬 처리 |
| **병렬화** | `enable_multithreading` | GPU 내장 병렬 | - |
| **호모토피 클래스** | `max_number_classes: 4` | N/A | TEB만 지원 |

**계산량 추정:**

**TEB:**
```
반복당 계산:
- Jacobian 계산: O(n²) where n = trajectory points
- QP solver: O(n³)
총 20회 반복
```

**MPPI (GPU):**
```
병렬 평가:
- 2000 trajectories × 80 points = 160,000 poses
- GPU로 동시 평가
- 비용 계산 및 가중 평균: O(N)
```

---

## 📐 수식 요약

### 동역학 제약 (Dynamics Constraints)
```
v(t) ∈ [0, 0.4] m/s
ω(t) ∈ [-1.0, 1.0] rad/s
a(t) ∈ [-0.8, 0.8] m/s²
α(t) ∈ [-3.2, 3.2] rad/s²
```

### 안전 제약 (Safety Constraints)
```
min(||p_robot - p_obs||) ≥ d_infl = 0.6 m
```

### 목표 조건 (Goal Conditions)
```
||p_robot - p_goal|| < 0.25 m
|θ_robot - θ_goal| < 0.25 rad
```

### 예측 지평 (Prediction Horizon)
```
T_pred = 4.0 s
d_pred = v_max × T_pred = 1.6 m
```

---

## ✅ 최종 검증 체크리스트

### 물리적 제약 (100% 동일 필수)
- [x] 최대 선속도: 0.4 m/s
- [x] 최대 각속도: 1.0 rad/s
- [x] 최대 선가속도: 0.8 m/s²
- [x] 최대 각가속도: 3.2 rad/s²
- [x] 로봇 풋프린트: 0.7m × 0.5m

### 안전 거리 (동일)
- [x] 인플레이션 거리: 0.6 m

### 예측 지평 (동등)
- [x] 예측 시간: ~4.0초
- [x] 예측 거리: ~1.6m

### 목표 정확도 (동일)
- [x] 위치 허용오차: 0.25 m
- [x] 방향 허용오차: 0.25 rad

### 제어 주파수 (동일)
- [x] 20 Hz (50ms)

---

## 🎯 결론

### 공정한 비교가 가능한 이유:

1. **동일한 물리적 제약**: 로봇의 속도/가속도 한계가 같음
2. **동등한 예측 거리**: 두 플래너 모두 약 1.6m 앞을 예측
3. **동일한 안전 기준**: 장애물로부터 0.6m 안전 거리 유지
4. **동일한 제어 주기**: 50ms마다 명령 발행

### 차이점 (알고리즘 본질적 특성):

1. **최적화 vs 샘플링**: TEB는 gradient-based, MPPI는 sampling-based
2. **호모토피 클래스**: TEB는 여러 경로 후보 고려, MPPI는 단일 분포
3. **계산 방식**: TEB는 CPU 반복 최적화, MPPI는 GPU 병렬 샘플링

### 성능 차이의 원인:

이 설정에서 나타나는 성능 차이는:
- ✅ 알고리즘의 본질적 특성에서 기인
- ✅ 공정하고 의미 있는 비교
- ❌ 파라미터 튜닝 차이에서 기인 (X)

