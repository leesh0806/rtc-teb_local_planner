## 1단계 (시뮬레이션 환경 구축 준비물)
1. 로봇모델은 크롤러 로봇을 사용함 cugoV3
2. 3D lidar 는 ouster lidar 사용
3. Imu사용
4. 월드는 내가 알아서 준비할꺼임

Ubuntu 22.04, ROS2  humble, gazebo fortress
## 2단계
## 🤖 2단계: 기본 Nav2 + TEB 구동 (Baseline 만들기)

**기본 상태**에서 문제가 생기는 것을 확인해야 합니다.

우선 지금은 경사가 있고 기복이 심한 환경이 아닌 일반  평평한 평지 주행으로 테스트 예정

**SLAM(SLAM Toolbox) 한 번 돌려서** Gazebo 월드의 2D 지도를 사용
Nav2를 켤 때 그 지도를 로드하세요.
`NavFn` (Global) + `TEB` (Local) 조합으로 목표지점을 찍습니다.
### 관전 포인트
### 1. 내비게이션 성능 지표

- 경로 추종 정확도: 계획된 경로와 실제 주행 궤적의 차이

- 목표 도달 성공률: 목표 지점에 제대로 도착했는가?

- 목표 도달 시간: 얼마나 걸렸나?

- 경로 부드러움: 급격한 방향 전환이나 떨림 측정

### 2. TEB 특화 지표

- 진동/흔들림 행동: 로봇이 앞뒤로 흔들리거나 망설이는가?

- 복구 행동 횟수: 문제 발생 시 복구 동작을 몇 번 실행하나?

- 경로 계산 시간: 궤적 계산에 걸리는 시간

- 대체 경로 개수: TEB가 고려하는 경로의 수 (homotopy classes)

### 3. 로봇 행동

- 선속도/각속도 프로파일: 부드러운가? 제한값 내에 있는가?

- 가속도 프로파일: 급격한 움직임은 튜닝이 잘못됨을 의미

- 바퀴 슬립: Odometry vs. Ground Truth 비교 (Gazebo가 제공)

- 장애물 회피 행동: 장애물과의 최소 거리

### 4. 환경 상호작용

- 좁은 통로 통과: 좁은 공간을 통과할 수 있는가?

- 동적 장애물 반응: 반응 시간과 경로 조정

- 코너 절단: 모서리를 너무 공격적으로 자르는가?


- **Nav2 설정:**
    - Global Planner: 하이브리드 A* 알고리즘 (그냥 목표지점 찍으면 선 그어주는 거면 충분함).
    - Local Planner: `teb_local_planner` 플러그인 설정.
- **실험 및 데이터 기록 (Baseline Data):**
	- 이것도 일단은 뭘 기록 하면 좋을까? 알려주셈

## 🎯 권장 테스트 워크플로우

### Phase 1: 센서 파이프라인 검증

1. Gazebo + 로봇 실행

2. Ouster가 /points 또는 /ouster/points로 발행하는지 확인

3. pointcloud_to_laserscan 실행 → /scan 출력 확인

4. RViz에서 스캔 품질 확인

### Phase 2: SLAM 매핑

1. /scan 입력으로 SLAM Toolbox 실행

2. 텔레오퍼레이션으로 월드 주행

3. 맵 저장 (map.pgm + map.yaml)

4. 맵 품질 확인

### Phase 3: Nav2 베이스라인

1. 저장된 맵으로 Nav2 실행

2. 여러 웨이포인트 설정하고 데이터 녹화

3. 성능 지표 분석

4. 문제 시나리오 식별

### Phase 4: 데이터 분석

1. rosbag 재생

2. 속도 프로파일, 궤적 플롯

3. 계획된 경로 vs. 실제 경로 비교

4. 실패 패턴 식별

## 📋 데이터 수집용 추가 도구

고려할 도구들:

- plotjuggler - 실시간 데이터 시각화

- nav2_metrics - Nav2 내장 성능 추적 (Humble에 있다면)

- 커스텀 Python 스크립트 - rosbag에서 지표 계산


## 질문
1. 근데 3d라이더를 사용하고 있는데 slam toolbox를 사용해서 2d 지도를 만드는 게 가능한가?
답변 : 3D LiDAR(`PointCloud2`) 데이터를 사용하더라도, **"Pointcloud to Laserscan"**이라는 변환 패키지를 중간에 끼워 넣으면 **SLAM Toolbox(2D)**를 완벽하게 사용할 수 있습니다.
이 방식은 **3D 데이터를 납작하게 꾹 눌러서(Projection) 2D 스캔 데이터처럼 만드는 원리**
- **3D LiDAR**는 수만 개의 점(`sensor_msgs/msg/PointCloud2`)을 뿜어냅니다.
- **SLAM Toolbox**는 한 줄짜리 레이저 스캔(`sensor_msgs/msg/LaserScan`)만 받을 수 있습니다.
- 따라서, **특정 높이 범위(예: 바닥 위 0.3m ~ 1.0m)**에 있는 점들만 잘라서 2D 평면 데이터로 바꿔주는 노드가 필요
```bash
sudo apt install ros-humble-pointcloud-to-laserscan
```
이 명령어로 설치하였음

일단은 여기까지 계획은 더 추가될 수 있음